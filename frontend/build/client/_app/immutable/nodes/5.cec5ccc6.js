import{_ as w}from"../chunks/preload-helper.a4192956.js";import{s as D,n as k,d as j,o as I}from"../chunks/scheduler.ffbd56c5.js";import{S as L,i as S,s as b,g as _,D as V,f as n,c as v,h as x,j as g,k as m,a as d,x as E,m as A,z as C,n as O,o as T}from"../chunks/index.02aeeab6.js";import{g as P}from"../chunks/navigation.f767a769.js";import{p as z}from"../chunks/stores.f244effd.js";import{h as H}from"../chunks/google-direct.658b226e.js";function J(p){let a,o="❌",r,i,c="Login error",t,s,e,u,f,y="Try again";return{c(){a=_("div"),a.textContent=o,r=b(),i=_("h1"),i.textContent=c,t=b(),s=_("p"),e=A(p[1]),u=b(),f=_("a"),f.textContent=y,this.h()},l(l){a=x(l,"DIV",{class:!0,"data-svelte-h":!0}),C(a)!=="svelte-1xroobb"&&(a.textContent=o),r=v(l),i=x(l,"H1",{class:!0,"data-svelte-h":!0}),C(i)!=="svelte-161sr8d"&&(i.textContent=c),t=v(l),s=x(l,"P",{class:!0});var h=g(s);e=O(h,p[1]),h.forEach(n),u=v(l),f=x(l,"A",{href:!0,class:!0,"data-svelte-h":!0}),C(f)!=="svelte-itmwiz"&&(f.textContent=y),this.h()},h(){m(a,"class","text-red-600 mb-4"),m(i,"class","text-xl font-semibold text-red-600 mb-2"),m(s,"class","text-gray-600 mb-4"),m(f,"href","/auth"),m(f,"class","btn-eco")},m(l,h){d(l,a,h),d(l,r,h),d(l,i,h),d(l,t,h),d(l,s,h),E(s,e),d(l,u,h),d(l,f,h)},p(l,h){h&2&&T(e,l[1])},d(l){l&&(n(a),n(r),n(i),n(t),n(s),n(u),n(f))}}}function N(p){let a,o,r,i="Processing login...",c,t,s="Wait a moment";return{c(){a=_("div"),o=b(),r=_("h1"),r.textContent=i,c=b(),t=_("p"),t.textContent=s,this.h()},l(e){a=x(e,"DIV",{class:!0}),g(a).forEach(n),o=v(e),r=x(e,"H1",{class:!0,"data-svelte-h":!0}),C(r)!=="svelte-1t9uj43"&&(r.textContent=i),c=v(e),t=x(e,"P",{class:!0,"data-svelte-h":!0}),C(t)!=="svelte-oxe331"&&(t.textContent=s),this.h()},h(){m(a,"class","inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-eco-600 mb-4"),m(r,"class","text-xl font-semibold text-gray-900 mb-2"),m(t,"class","text-gray-600")},m(e,u){d(e,a,u),d(e,o,u),d(e,r,u),d(e,c,u),d(e,t,u)},p:k,d(e){e&&(n(a),n(o),n(r),n(c),n(t))}}}function q(p){let a,o,r;function i(s,e){if(s[0])return N;if(s[1])return J}let c=i(p),t=c&&c(p);return{c(){a=b(),o=_("div"),r=_("div"),t&&t.c(),this.h()},l(s){V("svelte-nnn3os",document.head).forEach(n),a=v(s),o=x(s,"DIV",{class:!0});var u=g(o);r=x(u,"DIV",{class:!0});var f=g(r);t&&t.l(f),f.forEach(n),u.forEach(n),this.h()},h(){document.title="Processing Login - EcoLink",m(r,"class","text-center"),m(o,"class","min-h-[80vh] flex items-center justify-center")},m(s,e){d(s,a,e),d(s,o,e),E(o,r),t&&t.m(r,null)},p(s,[e]){c===(c=i(s))&&t?t.p(s,e):(t&&t.d(1),t=c&&c(s),t&&(t.c(),t.m(r,null)))},i:k,o:k,d(s){s&&(n(a),n(o)),t&&t.d()}}}function M(p,a,o){let r;j(p,z,t=>o(2,r=t));let i=!0,c=null;return I(async()=>{const t=r.url.searchParams.get("code"),s=r.url.searchParams.get("state");if(!t){o(1,c="Authorization code not found"),o(0,i=!1);return}try{if(await H(t,s||void 0),s)try{const{url:e}=JSON.parse(atob(s));if(e){const u=await fetch("http://localhost:8080/api/v1/links",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({url:e})});if(u.ok){const f=await u.json(),{pendingLink:y}=await w(()=>import("../chunks/navigation.f767a769.js").then(l=>l.b),["../chunks/navigation.f767a769.js","../chunks/singletons.edde51cd.js","../chunks/scheduler.ffbd56c5.js"],import.meta.url);y.set(f),P("/result");return}}}catch(e){console.error("Error processing state:",e)}P("/dashboard")}catch(e){console.error("Callback error:",e),o(1,c=e.message||"Authentication error"),o(0,i=!1)}}),[i,c]}class K extends L{constructor(a){super(),S(this,a,M,q,D,{})}}export{K as component};
