import{c as n}from"./env.0a8cfa1c.js";import{a as s,u as o,i as a}from"./navigation.f767a769.js";async function l(){s.set(!0);try{const e=await fetch(`${n.apiUrl}/api/v1/me`,{credentials:"include"});if(!e.ok)return o.set(null),a.set(!1),null;const t=await e.json();return o.set(t),a.set(!0),t}catch(e){return console.error("verifySession error:",e),o.set(null),a.set(!1),null}finally{s.set(!1)}}async function c(e,t){const i=await fetch(`${n.apiUrl}/auth/google/callback`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({code:e,redirect_uri:`${window.location.origin}/auth/callback/google`,state:t})});if(!i.ok)throw new Error("Authentication failed");const r=await i.json();return o.set(r.user),a.set(!0),r}function u(e){const t=new URLSearchParams({client_id:n.googleClientId,redirect_uri:`${window.location.origin}/auth/callback/google`,response_type:"code",scope:"openid profile email"});e&&t.append("state",e),window.location.href=`https://accounts.google.com/o/oauth2/v2/auth?${t}`}async function d(){await fetch(`${n.apiUrl}/auth/logout`,{method:"POST",credentials:"include"}).catch(()=>{}),o.set(null),a.set(!1),window.location.href="/"}const p={verifySession:l,handleCallback:c,login:u,logout:d};export{p as default,c as handleCallback,u as login,d as logout,l as verifySession};
